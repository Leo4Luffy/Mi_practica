---
title: "Metodología de machine learning"
subtitle: "Aplicación en datos del bovino criollo colombiano Romosinuano"
author: "Jorge Leonardo López Martínez; Freddy Hernandez Barajas"
institute: ""
date: ""
output:
  xaringan::moon_reader:
    css: estilo.css
---

<!--- 
Alguito de información sobre el paquete xaringan (https://bookdown.org/yihui/rmarkdown/xaringan.html) 

1. Para realizar una presentación usando este paquete, se hace lo siguiente: File -> New File -> R Markdown -> From Template -> Ninja Presentation... aparecerá luego un ejemplo R markdown en el editor 

2. Atajos de teclado: luego de abrir las diapositivas generadas, se puede presionar la tecla h (help) o ? para acceder al atajo de teclado que ayudaran a presentar mejor sus diapositivas, como por ejemplo: 
  - Presione b para oscurecer una diapositiva, y m para invertir todo en la diapositiva. Estas técnicas pueden ser útiles cuando no desea que la audiencia lea la diapositiva, por ejemplo, cuando tiene soluciones en una diapositiva pero no quiere mostrarlas a sus alumnos de inmediato.
  - Presione f para alternar el modo de pantalla completa.
  - Presione p para alternar el modo de presentador, el cual mostrara miniaturas de la diapositiva actual y la siguiente diapositiva a la izquierda, notas del presentador a la derecha, y también un temporizador en la parte superior derecha. La tecla p pueden ser muy útil cuando se presenta con su propia computadora conectada a una segunda pantalla (como un proyector). Puede presionar t para reiniciar el temporizador en cualquier momento.

3. Notas del presentador: Puede escribir notas para leer en el modo de presentador. Estas notas están escritas bajo tres signos de interrogación (?) después de una diapositiva, y la sintaxis también es en Markdown, lo que significa que puede escribir cualquier elemento compatible con Markdown, como párrafos, listas, imágenes, etc
--->

```{r Paquetes a usar, echo = FALSE, eval = TRUE, message = FALSE}

library(dplyr)
library(ggplot2)
library(DT)
library(raster)
library(sf)
library(ggsflabel)
library(ggforce)
library(showtext) # Link donde estan las fuentes Google (http://www.google.com/fonts)
font_add_google('Gochi Hand', 'gochi')
showtext.auto()
```


<section style="text-align: center;"><h2><p class="text-info">Objetivo y población de estudio</p></h2></section>

<br>

<div class = "row">

<div class = "col-md-6">

<section style="text-align: justify;"><p class="text-primary">Este estudio tuvo como objetivo aplicar la métodologia del <font color="black"><u>machine learning</u></font> en datos del bovino criollo colombiano Romosinuano.</p></section>

<section style="text-align: justify;"><p class="text-primary">Dichos datos se obtuvieron del núcleo animal de la raza criolla colombiana Romosinuano, el cual se mantiene como banco de germoplasma. Este núcleo se encuentra ubicado en el centro de investigación Turipaná (AGROSAVIA), localizado en el Valle del Sinú en el nordeste de Colombia.</p></section>

```{r Imagen, fig.align = 'center', eval = TRUE, echo = FALSE, message = FALSE, out.width = '280'}

knitr::include_graphics('Imagenes/Romo.jpg')
```

</div>

<div class = "col-md-6">

<!-- 
Con base en los tutoriales https://statnmap.com/2018-04-18-draw-maps-like-paintings/ y http://dlizcano.github.io/2018/05/23/Mapa-Animado-Fuegos.html se creo el mapa.
-->

```{r Mapa, fig.align = 'center', eval = TRUE, echo = FALSE, message = FALSE, warning = FALSE, out.width = '520', fig.showtext = TRUE}

mapa_Col <- getData('GADM', country = 'COL', level = 1) # Se accede a la información de Colombia.
mapa_Col_sf <- st_as_sf(mapa_Col) # Se convierte el anterior a un objeto sf.

ggplot(data = mapa_Col_sf) +
  geom_sf(data = mapa_Col_sf, aes(fill = NAME_1, colour = NAME_1), alpha = 0.4, colour = NA) +
  #annotate(geom = 'text', x = -77, y = 9.6, label = 'Córdoba', family = 'gochi', size = 5.4, colour = 'black') +
  geom_sf_label_repel(aes(label = NAME_1), label.padding = unit(1, 'mm')) +
  scale_colour_manual(values = c('yellow', 'green', 'black', 'chartreuse', 'magenta', 'springgreen', 'green', 'gray54', 'yellow', 'green', 'black', 'chartreuse', 'magenta', 'springgreen', 'green', 'gray54', 'yellow', 'green', 'black', 'chartreuse', 'magenta', 'springgreen', 'green', 'gray54', 'yellow', 'green', 'black', 'chartreuse', 'magenta', 'springgreen', 'green', 'gray54')) +
  scale_fill_manual(values = c('yellow', 'green', 'black', 'chartreuse', 'magenta', 'springgreen', 'green', 'gray54', 'yellow', 'green', 'black', 'chartreuse', 'magenta', 'springgreen', 'green', 'gray54', 'yellow', 'green', 'black', 'chartreuse', 'magenta', 'springgreen', 'green', 'gray54', 'yellow', 'green', 'black', 'chartreuse', 'magenta', 'springgreen', 'green', 'gray54')) +
  scale_y_continuous(limits = c(-5.2, 12)) +
  scale_x_continuous(limits = c(-80, -65)) +
  theme_void() +
  theme(legend.position = 'none') +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        axis.title = element_blank())
```

</div>

</div>

---

<section style="text-align: center;"><h2><p class="text-info">Los datos</p></h2></section>

<br>

<div class = "row">

<div class = "col-md-6">

<section style="text-align: justify;"><p class="text-primary">La base de datos comprende el registro informativo de la característica intervalo entre partos en bovino criollo colombiano Romosinuano.</p></section>

<section style="text-align: justify;"><p class="text-primary">Dicha base de datos se caracteriza por presentar una <font color="black"><u>estructura de clúster de tipo longitudinal</u></font>, cuyo ejemplo se puede observar en la siguiente imagen:</p></section>

```{r Ejemplo estructura longitudinal, fig.align = 'center', eval = TRUE, echo = FALSE, message = FALSE, fig.showtext = TRUE, out.width = '280'}

data.frame(
  x = c(0.5, 1.5, 0.5, 2.6, 2.0), 
  y = c(1, 1.5, 2.3, 1.3, 2.5),
  grupo = c('A', 'B', 'C', 'D', 'E')
) %>%
  ggplot(aes(x0 = x, y0 = y, r = 0.5, fill = grupo, colour = grupo)) +
  geom_circle(alpha = 0.2, size = 1.0) +
  annotate(geom = 'text', x = 0.4, y = 1.2, label = 'IEP 1', family = 'gochi', size = 8.4, colour = 'black') +
  annotate(geom = 'text', x = 0.6, y = 1.0, label = 'IEP 2', family = 'gochi', size = 8.4, colour = 'black') +
  annotate(geom = 'text', x = 0.5, y = 0.8, label = 'IEP 3', family = 'gochi', size = 8.4, colour = 'black') +
  annotate(geom = 'text', x = 1.1, y = 0.5, label = 'Bovino A', family = 'gochi', size = 10.4, colour = 'black') +
  annotate(geom = 'text', x = 1.4, y = 1.7, label = 'IEP 1', family = 'gochi', size = 8.4, colour = 'black') +
  annotate(geom = 'text', x = 1.6, y = 1.5, label = '...', family = 'gochi', size = 8.4, colour = 'black') +
  annotate(geom = 'text', x = 1.5, y = 1.3, label = 'IEP 5', family = 'gochi', size = 8.4, colour = 'black') +
  annotate(geom = 'text', x = 1.6, y = 0.95, label = 'Bovino C', family = 'gochi', size = 10.4, colour = 'black') +
  annotate(geom = 'text', x = 0.4, y = 2.5, label = 'IEP 3', family = 'gochi', size = 8.4, colour = 'black') +
  annotate(geom = 'text', x = 0.6, y = 2.3, label = 'IEP 4', family = 'gochi', size = 8.4, colour = 'black') +
  annotate(geom = 'text', x = 0.5, y = 2.1, label = 'IEP 5', family = 'gochi', size = 8.4, colour = 'black') +
  annotate(geom = 'text', x = 0.9, y = 2.84, label = 'Bovino B', family = 'gochi', size = 10.4, colour = 'black') +
  annotate(geom = 'text', x = 2.5, y = 1.5, label = 'IEP 1', family = 'gochi', size = 8.4, colour = 'black') +
  annotate(geom = 'text', x = 2.7, y = 1.3, label = 'IEP 3', family = 'gochi', size = 8.4, colour = 'black') +
  annotate(geom = 'text', x = 2.6, y = 1.1, label = 'IEP 6', family = 'gochi', size = 8.4, colour = 'black') +
  annotate(geom = 'text', x = 2.7, y = 1.84, label = 'Bovino E', family = 'gochi', size = 10.4, colour = 'black') +
  annotate(geom = 'text', x = 1.9, y = 2.7, label = 'IEP 1', family = 'gochi', size = 8.4, colour = 'black') +
  annotate(geom = 'text', x = 2.1, y = 2.5, label = 'IEP 2', family = 'gochi', size = 8.4, colour = 'black') +
  annotate(geom = 'text', x = 2.0, y = 2.3, label = 'IEP 3', family = 'gochi', size = 8.4, colour = 'black') +
  annotate(geom = 'text', x = 2.5, y = 3.06, label = 'Bovino D', family = 'gochi', size = 10.4, colour = 'black') +
  theme_void() +
  theme(legend.position = 'none') +
  scale_fill_manual(values = c('black', 'cyan', 'red', 'yellow', 'green')) +
  scale_colour_manual(values = c('black', 'cyan', 'red', 'yellow', 'green')) +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        axis.title = element_blank())
```

<!--
La estructura longitudinal se da cuando la observación se mide múltiples veces dentro de un mismo grupo.
-->

</div>

<div class = "col-md-6">

<section style="text-align: justify;"><p class="text-primary">Por lo cual es necesario emplear el <font color="black"><u>modelo mixto</u></font> para tratar este tipo de datos, usando de forma simultanea la metodología del machine learning.</p></section>

```{r, fig.align = 'center', out.width = "340", eval = TRUE, echo = FALSE, message = FALSE}

knitr::include_graphics('Imagenes/octocat.png')
```

</div>

</div>

---

<section style="text-align: center;"><h2><p class="text-info">Los datos</p></h2></section>

<br>

<section style="text-align: justify;"><p class="text-primary">Se inicio previamente con el <font color="black"><u>pre-procesamiento de los datos</u></font>, cuyo objetivo consistió en proporcionar un conjunto de datos de entrenamiento de buena calidad. <!-- El rendimiento del modelo tiene una relación lineal con la calidad de los datos de muestra de entrenamiento que se incorporaron al modelo mismo.--> Los pasos principales del pre-procesamiento de datos, a saber, fueron la extracción de los datos y su limpieza.</p></section>

<div class = "row">

<div class = "col-md-6">

<div class="alert alert-dismissible alert-warning">
  Extracción de los datos
</div>

<section style="text-align: justify;"><p class="text-primary">La <font color="black"><u>extracción de los datos</u></font> tiene un papel importante en mejorar el tiempo de aprendizaje y aumentar el tamaño de los datos. El objetivo de este proceso de extracción es adquirir la matriz de datos de entrada apropiada como muestra de aprendizaje.</p></section>

<section style="text-align: justify;"><p class="text-primary">La extracción de información en el conjunto de datos de este estudio se realizó mediante la selección de aquellas variables (predictoras) que tuvieran relación con la variable respuesta intervalo entre partos.</p></section>

</div>

<div class = "col-md-6">

<p>&#8628;</p>

<br>

<section style="text-align: justify;"><p class="text-primary">Esto debido a que el propósito de la metodología a emplear consiste en estimar el valor de dicha variable respuesta en base a las variables predictoras, como se puede observar en la expresión $\small y = f(x) + b$.</p></section>

<section style="text-align: justify;"><p class="text-primary">Las variables de estudio usadas en la modelación se presentan en la tabla a continuación: →</p></section>

</div>

</div>

<!-- A continuación, se exporta la base de datos a usar y se seleccionan un conjunto de variables predictoras -->

```{r Exportación y selección de variables, echo = FALSE, eval = TRUE, message = FALSE}

Base_datos <- read.csv2(file = '/home/leo/Documentos/Ossa/a1120.csv', sep = ',', header = TRUE) # Este conjunto de datos ya fue depurado previamente (en Depuración.R esta todo este proceso)... dicha depruración consistió, por ejemplo, en rastrear bovinos con registros de un mismo parto repetidos, e incluir información de posibles partos faltantes.

Base_datos_2 <- Base_datos %>%
  mutate(
    Fech_parto = as.Date(as.character(Fech_parto, format = '%m/%d/%Y')),
    Mes_parto = format(Fech_parto, '%m'),
    Ano_parto = format(Fech_parto, '%Y')
  ) %>%
  dplyr::select(IEP, N_parto, Sexo_hija, Edad_parto, Mes_parto, Ano_parto, D_abierto)
```

---

<section style="text-align: center;"><h2><p class="text-info">Los datos</p></h2></section>

<br>

<section style="text-align: justify;"><p class="text-primary">Se inicio previamente con el <font color="black"><u>pre-procesamiento de los datos</u></font>, cuyo objetivo consistió en proporcionar un conjunto de datos de entrenamiento de buena calidad. <!-- El rendimiento del modelo tiene una relación lineal con la calidad de los datos de muestra de entrenamiento que se incorporaron al modelo mismo.--> Los pasos principales del pre-procesamiento de datos, a saber, fueron la extracción de los datos y su limpieza.</p></section>

<div class = "row">

<div class = "col-md-6">

<div class="alert alert-dismissible alert-warning">
  Extracción de los datos
</div>

<section style="text-align: justify;"><p class="text-primary"></p>

<table class="table table-hover">
  <thead>
    <tr>
      <th scope="col">Nombre</th>
    </tr>
  </thead>
  <tbody>
    <tr class="table-danger">
      <th scope="row">Intervalo entre partos</th>
    </tr>
    <tr class="table-warning">
      <th scope="row">Orden de parto</th>
    </tr>
    <tr class="table-info">
      <th scope="row">Sexo de la cría</th>
    </tr>
    <tr class="table-dark">
      <th scope="row">Edad al parto</th>
    </tr>
    <tr class="table-light">
      <th scope="row">Época de parto</th>
    </tr>
  </tbody>
</table>

</section>

</div>

<div class = "col-md-6">

<p>&#8628;</p>

<br>

<table class="table table-hover">
  <thead>
    <tr>
      <th scope="col">Nombre</th>
    </tr>
  </thead>
  <tbody>
    <tr class="table-secondary">
      <th scope="row">Año de parto</th>
    </tr>
    <tr class="table-danger">
      <th scope="row">Días abiertos</th>
    </tr>
  </tbody>
</table>

```{r, fig.align = 'center', out.width = '160', eval = TRUE, echo = FALSE, message = FALSE}

knitr::include_graphics('Imagenes/octocat_2.png')
```

</div>

</div>

---

<section style="text-align: center;"><h2><p class="text-info">Los datos</p></h2></section>

<br>

<section style="text-align: justify;"><p class="text-primary">Se inicio previamente con el <font color="black"><u>pre-procesamiento de los datos</u></font>, cuyo objetivo consistió en proporcionar un conjunto de datos de entrenamiento de buena calidad. <!-- El rendimiento del modelo tiene una relación lineal con la calidad de los datos de muestra de entrenamiento que se incorporaron al modelo mismo.--> Los pasos principales del pre-procesamiento de datos, a saber, fueron la extracción de los datos y su limpieza.</p></section>

<div class = "row">

<div class = "col-md-6">

<div class="alert alert-dismissible alert-danger">
  Limpieza de los datos
</div>

<section style="text-align: justify;"><p class="text-primary">La limpieza de los datos tiene el propósito de corregir los datos faltantes en los conjuntos de datos que provienen de varias fuentes, por ejemplo, error de datos de entrada, error de programación, error en la transferencia de datos, etc.</p></section>

<section style="text-align: justify;"><p class="text-primary">En el caso de datos de interés zootecnico, la limpieza consiste también en no considerar animales con identificación dudosa, información fuera del rango normal de la variable respuesta o valores fisiológicamente anormales.</p></section>

</div>

<div class = "col-md-6">

<p>&#8628;</p>

<br>

```{r Limpieza del conjunto de datos, echo = FALSE, eval = TRUE, message = FALSE}

Base_datos_3 <- Base_datos_2 %>%
  filter(
    Sexo_hija %in% c('H', 'M') & # Habian bovinos identificado como " M", "h", "He:Rp", "m" y " "... estos no se consideraron.
      IEP != 'is.na' & # No se consideraron valores faltantes para la variable respuesta intervalo entre partos.
      IEP >= 300 & IEP <= 1278 & # Se limitaron los días entre partos de 300 a 1278 días ya que valores fuera de este rango pueden no ser normales.
      D_abierto >= 21 & D_abierto <= 250 & # Los días abiertos fueron restringidos de 21 a 250 días, ya que valores fuera de éste rango pueden ser fisiológicamente anormales o estar registrados erróneamente.
      N_parto != 'is.na' & # No se consideraron valores faltantes para la variable predictora número de parto.
      Edad_parto != 'is.na' & # A continuación no se consideran valores incosistentes para la edad al parto:
      Edad_parto > 0 &
      Edad_parto != 20746
  ) %>%
  mutate(
    Mes_parto = as.integer(Mes_parto),
    Epoca_parto = case_when( # Fueron formadas tres clases definidas como meses de época de lluvia (meses de julio a septiembre), de transición (meses de abril a junio y de octubre a diciembre) y de sequía (meses de enero a marzo).
      Mes_parto %in% c(1:3) ~ 'Sequia',
      Mes_parto %in% c(4:6) ~ 'Transición',
      Mes_parto %in% c(7:9) ~ 'Lluvia',
      Mes_parto %in% c(10:12) ~ 'Transición'
      )
    )

edad_parto <- Base_datos_3 %>%
  mutate(N_parto = as.factor(N_parto)) %>%
  filter(
    Edad_parto != 'is.na' &
      Edad_parto > 0
    ) %>%
  group_by(N_parto) %>%
  summarise(Promedio = mean(Edad_parto), N = length(N_parto), Mínimo = min(Edad_parto), Máximo = max(Edad_parto))
```

<section style="text-align: justify;"><p class="text-primary">La limpieza de los datos en el conjunto de datos de este estudio consistió en limitar los días entre partos de 300 a 1278 días, los días abiertos de 21 a 250 días y no considerar datos faltantes (NA).</p></section>

<section style="text-align: justify;"><p class="text-primary">Las variables de estudio usadas en la modelación se describen en la tabla a continuación: →</p></section>

</div>

</div>

---

<section style="text-align: center;"><h2><p class="text-info">Los datos</p></h2></section>

<table class="table table-hover">
  <thead>
    <tr>
      <th scope="col">Nombre</th>
      <th scope="col">Tipo de variable estadística</th>
    </tr>
  </thead>
  <tbody>
    <tr class="table-danger">
      <th scope="row">Intervalo entre partos</th>
      <td>Continua, registrada entre 300 días (valor mínimo) a 826 días (valor máximo).
      </td>
    </tr>
    <tr class="table-warning">
      <th scope="row">Orden de parto</th>
    </tr>
    <tr class="table-info">
      <th scope="row">Sexo de la cría</th>
      <td>Discreta (nominal), formada por Hembra y Macho.
      </td>
    </tr>
    <tr class="table-dark">
      <th scope="row">Edad al parto</th>
      <td>Continua, registrada entre los 472 (valor mínimo) a 6962 días (valor máximo).</td>
    </tr>
    <tr class="table-light">
      <th scope="row">Época de parto</th>
      <!--<td>Discreta (nominal), formada por época de sequía (de enero a marzo), de transición (de abril a junio y de octubre a diciembre) y de lluvia (de julio a septiembre).
      </td>-->
    </tr>
    <tr class="table-secondary">
      <th scope="row">Año de parto</th>
    </tr>
    <tr class="table-danger">
      <th scope="row">Días abiertos</th>
      <td>Continua, registrada entre los 21 (valor mínimo) a 250 días (valor máximo).
      </td>
    </tr>
  </tbody>
</table>

---

<section style="text-align: center;"><h2><p class="text-info">Los datos</p></h2></section>

<br>
